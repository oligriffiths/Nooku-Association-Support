So, basic data gateway associations for Nooku 12.1 and up :)

This system will automatically work out associations based on table and column naming conventions.

Associations are determined using the following rules.

One to one associations:
These are determined using the columns from the target table. Any column ending _id is created as a association minus the _id

One to many associations:
These are determined following a naming convention. Any tables in the DB that belong to the same package that match the
singular of the source table followed by an underscore. Also any tables that contain a column of the source table singular followed by _id.
E.g. package_users is related to package_user_groups. Also, package_users is related to package_posts if posts contains a user_id column

Many to many associations:
These are determined following a naming conventions. Any tables in the DB that belong to the same packages that match the
plural of the source table followed by or preceded by an underscore. Also any tables that contain a column of the source table singular followed by _id.
Also, if a relationship is defined for the table matched above, then an identifier for the source model is created by removing the plural suffix.
E.g. package_posts is related to package_posts_categories which is in turn related to package_posts. So package_posts > package_posts_categories > package_categories

This data is then passed to the row object that uses this relationship information in order to lookup data.

Relationships must be specified in the following format:

property_name => array(
	'type' => 'association type' (one of one_one|one_many|many_many)
	'model' => 'a nooku model identifier string or object',
		this is the identifer for the source model where the data is being retrieved from

	'keys' => array('foreign_key' => 'local_key'),
		foreign key is the key for the related table, local key is the column in this table that contains the value.
		when creating a many to many relationship this refers to the key within the relationship table defined below

	'through' => 'a nooku model identifier' (optional)
              only required for many to many association. This is the ID for the "through" table (e.g. a relationship table) that associations are made.
      )



Then to use you simply do:

One to One:
$user->profile->name;

One to many
foreach($user->documents AS $document){}

Or passing state information to the documents model
foreach($user->documents(array('enabled' => true)) AS $document){}

Many to many:
foreach($user->groups AS $group){}

State information can be passed in the same format at above

There is a sample component: com_test

Happy coding :)